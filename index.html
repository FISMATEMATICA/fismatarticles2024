<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Publications 2024</title>

  <style>
    /* Estética preservada */
    body { font-family: "Segoe UI", Arial, sans-serif; margin:0; background:#f7f9fc; color:#333; }
    header { background:#004d4d; padding:2em; text-align:center; }
    header h1 { color:#fff; font-size:2.5em; margin:0; }
    #results { max-width:900px; margin:2em auto; padding:0 1em; }
    .paper { margin-bottom:1.5em; padding:1.2em; background:#fff; border-left:6px solid #004d4d;
             border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.05); transition:transform .2s ease; }
    .paper:hover{ transform:translateY(-2px); }
    .title a{ font-size:1.2em; font-weight:bold; color:#004d4d; text-decoration:none; }
    .meta{ margin-top:.5em; color:#555; font-size:.95em; }
    .loading{ text-align:center; padding:2em 0; color:#666; }
  </style>
</head>
<body>
  <header><h1>Publications 2024</h1></header>
  <div id="results" class="loading">Carregando artigos...</div>

  <script>
    // URL do seu Worker
    const WORKER_BASE = "https://spring-glade-d911.fismat.workers.dev/";
    const resultsDiv = document.getElementById("results");
    const TARGET_YEAR = "2024";

    // Lista original de autores de 2024 (Preservada)
    const nomesDestacados = [
      "Gustavo Burdman", "Renata Zukanovich Funchal", "Oscar Eboli", "O. J. P. Eboli",
      "Gustavo F. S. Alves", "Matheus Martines", "Luighi P. S. Leal", "L.P. Santos Leal",
      "L. P. Santos Leal", "L. P. S. Leal", "Peter Reimitz", "Ana Luisa Foguel",
      "Gabriel M. Salla", "Oscar J. P. Éboli", "Lucas Magno D. Ramos",
      "Gustavo S.S. Sakoda", "G.S.S. Sakoda", "Disha Bhatia", "Sujay Shil",
      "Rafiqul Rahaman", "Barbara Amaral", "Eduardo Casali", "Elisa G.M. Ferreira",
      "Frederique Grassi", "J.C.A. Barata", "João C. A. Barata", "Joao C. A. Barata",
      "L.R.W.Abramo", "L. Raul Abramo", "R. Abramo", "Raul Abramo", "Natália V.N. Rodrigues",
      "Marcos Lima", "Matthew Luzum", "Luis Raul Abramo", "João Vitor Dinarte Ferri",
      "Igor Neiva Mesquita", "Álvaro S. de Jesus", "Á.S. de Jesus", "Naim Elias Comar",
      "Alisson Tezzin", "Ian Tashiro", "Kevin Pala", "Pedro Ishida", "Luis F. Santos",
      "Luís F. Santos", "L. R. Abramo", "O. J. P. Éboli", "Bárbara Amaral",
      "R. Zukanovich Funchal", "Pedro Bittar", "Rafael Grossi"
    ];


    // --- Funções Auxiliares ---

    function deveDestacarAutor(nome) {
      // Normaliza e deixa em minúsculo para comparação
      const n = nome.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim();
      return nomesDestacados.some(a => 
        a.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase().trim() === n
      );
    }

    function escapeHtml(text) {
      if (!text) return "";
      return text.replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;")
                 .replace(/'/g, "&#039;");
    }

    // Transforma XML (entry nodes) em objeto JS
    function parseEntry(node) {
      const getText = (tag) => {
        const el = node.getElementsByTagName(tag)[0];
        return el ? el.textContent.trim() : "";
      };

      const id = getText("id");
      const title = getText("title");
      const published = getText("published").slice(0, 10);
      const updated = getText("updated").slice(0, 10);
      const journal_ref_node = node.getElementsByTagName("journal_ref")[0];
      const journal = journal_ref_node ? journal_ref_node.textContent.trim() : "";

      const authorNodes = node.getElementsByTagName("author");
      const authors = [];
      for (let a of authorNodes) {
        const nameNode = a.getElementsByTagName("name")[0];
        if (nameNode) authors.push(nameNode.textContent.trim());
      }

      return { id, title, published, updated, authors, journal };
    }

    // Remove entradas duplicadas por id
    function dedupe(entries) {
      const seen = new Set();
      const out = [];
      for (const e of entries) {
        if (!e.id) continue;
        if (!seen.has(e.id)) { seen.add(e.id); out.push(e); }
      }
      return out;
    }

    // --- Função Principal ---

    async function carregarResultados() {
      resultsDiv.className = "loading";
      resultsDiv.textContent = "Carregando artigos...";

      try {
        const autoresQuery = nomesDestacados
          .map(nome => `au:"${nome.replace(/"/g, "").replace(/\s+/g, "+")}"`)
          .join("+OR+");

        const arxivURL = `https://export.arxiv.org/api/query?search_query=${autoresQuery}&sortBy=submittedDate&sortOrder=descending&max_results=500`;
        const proxyURL = WORKER_BASE + "?url=" + encodeURIComponent(arxivURL);

        const resp = await fetch(proxyURL, { method: "GET" });
        if (!resp.ok) throw new Error("Resposta do Worker: " + resp.status + " " + resp.statusText);

        const xmlText = await resp.text();
        const xml = new DOMParser().parseFromString(xmlText, "application/xml");
        const entriesNodes = Array.from(xml.getElementsByTagName("entry"));

        let entries = entriesNodes.map(parseEntry);
        entries = dedupe(entries);

        // Filtro Robusto (Publicado OU Atualizado em 2024)
        entries = entries.filter(e => 
          (e.published && e.published.startsWith(TARGET_YEAR)) ||
          (e.updated && e.updated.startsWith(TARGET_YEAR))
        );
        
        // Filtra para incluir apenas se houver ao menos um autor destacado
        entries = entries.filter(e => e.authors.some(a => deveDestacarAutor(a)));

        // Adiciona campo Date para ordenação
        entries = entries.map(e => ({ 
          ...e, 
          _date: new Date(e.updated || e.published) 
        }));

        // Ordena do mais recente para o mais antigo
        entries.sort((a, b) => b._date - a._date);

        if (!entries.length) {
          resultsDiv.className = "";
          resultsDiv.innerHTML = '<div class="muted">Nenhum artigo de 2024 encontrado.</div>';
          return;
        }

        // Monta HTML
        const html = entries.map(e => {
            // Separa os autores destacados
            const destacados = e.authors.filter(deveDestacarAutor);
            // Separa os outros autores
            const outros = e.authors.filter(a => !deveDestacarAutor(a));

            // Junta: Destacados primeiro, Outros depois
            const ordenados = [...destacados, ...outros];

            // Limita a 8 nomes exibidos
            const exibidos = ordenados.slice(0, 8);
            const etAl = ordenados.length > 8 ? ", et al." : "";

            // Formata com negrito
          const authorsHTML = exibidos
            .map(a => deveDestacarAutor(a) ? `<strong>${escapeHtml(a)}</strong>` : escapeHtml(a))
            .join(", ");
          
          return `
            <div class="paper">
              <div class="title"><a href="${e.id}" target="_blank" rel="noopener noreferrer">${escapeHtml(e.title)}</a></div>
              <div class="meta">Autores: ${authorsHTML}${etAl}</div>
              <div class="meta">Publicado em: ${e.published}</div>
              <div class="meta">Última atualização: ${e.updated}</div>
              ${e.journal ? `<div class="meta">${escapeHtml(e.journal)}</div>` : ""}
            </div>
          `;
        }).join("");

        resultsDiv.className = "";
        resultsDiv.innerHTML = html;

      } catch (error) {
        console.error("Erro na carga de dados:", error);
        resultsDiv.className = "";
        resultsDiv.innerHTML = `<div class="muted">Erro ao carregar os dados: ${escapeHtml(error.message)}</div>`;
      }
    }

    // inicia a carga
    carregarResultados();
  </script>
</body>
</html>
